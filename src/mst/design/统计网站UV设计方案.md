---
title: 统计网站UV设计方案
date: 2023-12-01
icon: eos-icons:quota
---



## 统计网站UV设计方案



#### 设计方案



统计网站UV的设计方案可以按照网站的访问量来进行设计，主要是有两种设计方案

如果我们的网站的访问量不大的话，可以使用hash表来存储，用网站id+时间作为key,再用访客ip作为set，这样我们就可以对指定的网页来进行去重并且可以统计访问数。

但是当我们网站的数据量大的时候，我们的性能就会变慢，存的时候先去set中判断有没有重复的，如果set很长的话这个时间就会花费的很多了。



如果我们的网站的访问量很大的话，上面的设计方案就不可以了，就需要使用下面的设计方案：

在redis中有一种数据结构叫做Hyperloglog，这个数据结构天生就可以去重，而且内存占用很少，所以非常适合用来作为网站UV统计的数据结构。



针对redis中某个key,如果我们想要看它的key的序列化长度，以及一些信息的话，我们可以使用命令

```redis
debug object key 
```



通过对hashset和Hyperloglog的内存占用发现，如果有10w个数据的话，Hyperloglog的内存使用大约是10k,而Set的内存使用大约是965kb



但是要注意，如果使用的是Hyperloglog的话，统计的结果是会有一定的误差的，但是对于统计网站uv这种场景来说的话，这个误差是完全可以接受的。

如果我们要使用Hyperloglog并且还要能够统计指定时间的访客数的话，我们可以对key进行改造，将时间加在key上。



当然除了上面的两种方案，我们还可以使用一些开源的项目，比如百度的Doris和俄罗斯的ClickHouse



![分析redis中key的序列化信息命令](https://cdn.jsdelivr.net/gh/EyeDroplyq/myblog-img@master/分析redis中key的序列化信息命令.png)



**总结：整体来说，这个方案是很简单，但是前提是要知道redis中的这个Hyperloglog数据结构**

END .....