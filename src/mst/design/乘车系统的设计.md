---

title: 乘车系统的设计
date: 2023-12-23 11:41:48
icon: eos-icons:master
---

## 乘车系统的设计



#### 一、乘车系统的基础功能

##### 1.用户注册和登录功能

##### 2.二维码生成功能

##### 3.支付功能

##### 4.线路查询功能

##### 5.获取地铁实时位置功能

##### 6.查询交易记录功能



功能需求图如下所示：

![功能需求图](https://cdn.jsdelivr.net/gh/EyeDroplyq/myblog-img@master/功能需求图.png)

#### 二、设计

- 用户注册和登录功能

根据用户的个人信息和支付方式来进行注册，将注册后的信息保存到数据库中



- 二维码生成功能

​	根据用户的登录信息来生成二维码，使用这个二维码来进行乘车和下车的扫码，二维码生成之后要进行加密来保存用户的基本信息和支付信息，然后这个二维码还需要有有效期来提高安全性，同时二维码的生成是一个高并发的功能。因为早晚高峰的时候，通勤的人同时使用乘车系统就会同时来生成二维码，所以我们需要将这个功能做成高并发的。

​	二维码的生成策略我们可以使用QR码，QR码比原始的Bar Code条形码可以存储更多的信息。

​	为了满足高并发的需要，我们可以使用以下的方案：

	1. 使用缓存（比如Redis）来将用户生成的二维码缓存起来，可以避免每次打开app都会生成一个新的二维码。
	1. 进行限流，比如限制每个用户每分钟只能生成5个二维码，不能无限次的获取二维码
	1. 使用负载均衡，将用户获取二维码的请求负载均衡到后台服务器集群中



​	在用户乘车或者地铁的时候扫码的时候要进行校验的，首先在进站的时候扫码之后会将信息传到后台，后台会去判断这个二维码的合法性和有效性，然后判断用户的支付状态，来查询是否有未支付的订单，如果上述都没有问题的话，就记录进站

​	

​	用户在扫码出站的时候也是同理，进行判断没有问题的话才可以出站。



- 支付功能

​	支付功能一般需要和第三方的支付公司进行合作，同时支付也是一个高并发的场景，但是相对于二维码的生成来说，实时性要求不高，所以应对支付的功能我们可以采用不同的方案，比如我们可以使用消息队列来进行流量的削峰，随之伴随的就是一定的延迟，但是是可以接收的。

​	支付功能同时要将用户的支付流水信息进行保存，来让用户进行查询和对账，以及根据这个支付信息来采取一定的优惠政策。



- 线路查询功能和获取地铁实时位置功能

​	交通部门会将最新的线路信息保存到数据库中，然后根据数据库中的最新的线路信息来提供查询功能。同时可以根据地铁的定位信息来获取地铁的实时位置信息。



- 查询交易记录功能

​	根据支付后保存的流水信息来提供查询交易记录功能



整个系统的运行流程如图所示：

![整体流程图.png](https://cdn.jsdelivr.net/gh/EyeDroplyq/myblog-img@master/整体流程图.png)







#### 三、乘车系统的非功能需求

1. 用户分布不均

​	一线城市和其他的城市相比，用户量不是一个量级的，所以不同的城市用户分布是不均衡的

 

	2. 时间分布不均匀

​	对于早晚高峰和平常时间来说时间分配是不均匀的,早晚高峰的并发量和平常时间的并发量不是一个量级的



​	3.高并发

​	高峰期时间会有大量用户使用，所以肯定要具有高并发的能力



​	4.高性能

​	通勤要尽可能的帮助用户减少时间的使用，所以要尽可能的提高性能，减少响应时间



​	5.高可用

​	整个系统要尽量的保证24/7可用性



​	6.可扩展性

​	整个系统要有根据用户量的增加而扩展的能力



​	7.安全和隐私保护

​	系统需要保护用户数据的安全和隐私，包括支付信息和个人信息的保护





#### 四、数据库的设计

​	简单列举一下必须的数据表以及里面的一些基础字段

​	首先所有的表都应该有创建时间、修改时间、创建人、修改人、逻辑删除的基本字段

​	用户表：用户ID，主键ID，手机号、密码、支付方式等

​	二维码表：主键ID，二维码ID，二维码创建时间、城市ID、二维码有效时间、二维码数据等

​	车辆/地铁车次表：主键ID，车辆ID，车牌、车型、扫描设备ID等

​	乘车记录存储：主键ID，用户ID，车辆ID，乘车时间、乘车地点信息等

​	支付信息：主键ID,用户ID，支付金额、支付时间、支付流水号，支付方式、支付状态等





#### 五、扩展功能



* 附近最近场站推荐功能

我们可以给我们的乘车系统添加一些额外的功能，比如路线推荐、附近最近场站推荐、广告系统、消息推送系统等，我们可以根据用户当前的经纬度信息然后使用Redis中的GEO来进行附近场站站点的推荐功能，因为我们有场站的信息表，所以很容易就能实现这个功能。

多说一句，楼主本人刚毕业进入公司后做的就是这个功能，但是如果我们使用GEO的话只能够推荐的是附近的场站的直线距离，如果我们要推荐实际距离的话我们还可以使用第三方的地图组件来实现。



- 推荐最短时间通勤功能

​	我们可以利用场站信息表中的场站的信息，可以将所有的场站看成一个图，然后最简单的就是使用迪杰斯特拉算法来推荐最短距离，然后给用户返回，来让用户选择。





**总结：可以根据自己的实际业务需要来进行具体的设计和扩展，这篇文章只是简单的罗列一些基本的功能**





END......



 







