---
title: 短链系统的设计方案
date: 2023-11-26
icon: eos-icons:molecules
---



## 短链系统的设计方案

##### 什么是短链？

短链说的简单点就是将一个很长的url，转成一个端的字符串，然后用户可以通过这个短的字符串去访问原始的url网址。

##### 使用短链有什么好处？

1、短链更简洁，更加适合在互联网上进行传播

2、便于进行链路追踪来统计一些数据，比如我们可以根据这个短链来统计访问数，ip地址等等

3、对于一些网站的评论或者内容中是有字数限制的，使用短链可以减少网站的字符串的使用，可以更多的增加我们的文本内容。

#### 设计

短链系统的设计主要有两个方向，第一个方向是一个原始url对于唯一的一个短链；另一个方向就是一个原始的url可以根据不同的需求和场景来对应多个短链

##### 数据表的设计

| 名称      | 属性 | 备注 |
| ----------- | ----------- |----------|
| id      | bigint       |  主键id|
| long_url   | varchar(255)        |    原始url地址|
| short_url  | varchar(32)|短链地址|



#### 保证唯一性

我们要保证唯一性，要保证原始url和生成的短链有唯一的关系，也就是通过这个短链可以唯一确定一个原始的url地址

如果要保证唯一性的话，我们在生成短链的时候，可以使用哈希算法，推荐使用非加密的哈希算法，因为安全性高，而且当前这个业务也没有必要进行加密处理，因为不管是原始的url还是短链都是让用户去访问的，所以使用非加密的哈希算法就可以了，而且非加密的哈希算法的效率比加密的哈希算法高很多。非加密的哈希算法比如：MurmurHash算法


对于生成的这个短链的长度当然也在我们的考虑范围内，我们可以将生成的短链哈希值转成62进制，这样长度会更小。

#### 哈希冲突

当然我们使用哈希算法的话，肯定会出现哈希碰撞的问题，即使概率很小，但是我们依然要考虑到这个问题。其实发生哈希冲突之后的处理很简单，每次发生哈希碰撞之后我们就生成一个随机的字符串然后拼接到原始的短链字符串后面，当然还有别的一些解决方案，比如发生hash碰撞了的话，在短链后面拼接上一个分布式id


#### 如何判断发生了哈希冲突呢？

如果我们使用的是关系型数据库比如MySQL的话，我们可以给short_url这个字段加上一个唯一约束，但是不能很好的应对高并发。如果想要很好的应对高并发的话，推荐使用布隆过滤器。使用布隆过滤器去判断是不是发生了hash碰撞，当然如果使用布隆过滤器的话会出现误判的情况。所以我们也要处理误判的情况。一个最简单的方法就是去表中查询一下是不是真的发生了哈希碰撞。


#### 对原始的url地址进行合法性校验

我们在对原始的url进行生成短链的时候我们需要进行合法性判断，防止一些不法分子使用漏洞生成一些不安全的短链来诱导用户去访问不安全的网站。

首先我们要对要生成短链的这个url检查它的域名是不是在我们的合法性域名名单中。其次我们要判断查询参数域名是不是合法的。


##### 但是一般在互联网场景下，一个原始的url地址会根据不同的场景和需求生成多个不同的短链，比如在互联网营销中，针对不同的销售渠道会生成不同的短链，这样方便后面对不同的短链进行监控和统计不同渠道的销售效果。


#### 短链系统要配套建设对应的监控、统计、分析服务


#### 性能优化

首先万金油就是使用缓存，如果一个原始的url对应多个短链的话，只需要缓存短链到长链的映射关系即可。如果一个原始url只会生成一个短链的话，推荐将长链到短链以及短链到长链的映射关系都缓存起来。

在缓存的时候，将访问频率高的短链缓存起来，为了防止内存使用过多，我们可以设置一个过期时间，每次访问的时候来给它续期。

MySQL数据库存储的数据我们可以使用索引来提高性能，可以给主键id加一个主键索引，以及给short_url字段加一个唯一索引。



END.....





